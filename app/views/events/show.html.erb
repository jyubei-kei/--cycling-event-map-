<h1><%= @event.name %></h1>
<p><%= @event.description %></p>

<h2>エイドステーション</h2>
<div map id="map" style="height: 400px;"></div>

<script>
  document.addEventListener("turbo:load", () => {
    const mapEl = document.getElementById("map");
    if(!mapEl) return;

      const aidStations = <%= raw(
        @event.aid_stations.select(:name, :latitude, :longitude).to_json
      ) %>;

    const map = L.map("map").setView([34.55589157441934, 132.38015867738127], 10);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    aidStations.forEach(aid => {
      if(!aid.latitude || !aid.longitude) return;

      L.marker([aid.latitude, aid.longitude])
        .addTo(map)
        .bindPopup(aid.name);
    });
  });
  </script>