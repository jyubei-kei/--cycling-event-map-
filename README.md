# --cycling-event-map-
サイクリングイベント参加者の位置とコースを表示するWebサービス

## サービス概要
サイクリングイベント参加者がスマホから登録すると、MAP上に自分の位置がリアルタイムで表示されます
コースルートやエイドステーションが地図上に描画され、補給情報も確認できます
管理者はイベント情報を設定・更新でき、全体の動きを一目で把握できます
参加者はスマホから簡単に参加・チェックインできるサービスです

## このサービスへの思い・作りたい理由
私は毎年数回、サイクリングイベントでサポート（移動観察員）として参加しています
その中で、次のような課題を強く感じました
- スタッフの位置が分からず、ライングループなどのやり取りで状況を確認していた
- 参加者がコースミスした際、どこにいるのか把握できないためすぐに対応できない
- コースミスに気付くのが遅く、10キロメートル以上余計に走ってしまう参加者もいた

これらの経験から、「位置情報を共有できる仕組みがあれば、安全性も運営効率も大きく向上するのでは」
と強く、このサービスを作りたいと考えました

## ユーザー層について
- サイクリングイベント管理者
- 参加者

## サービスの利用イメージ
**参加者側**
- 「安心して走れる」
- 「イベント全体の一体感を楽しめる」という価値を得られます

**管理者側**
- 参加者の動きを把握できることで安全管理の向上
- 運営効率の改善につながる

## ユーザーの獲得について
今サポートしているサイクリングイベントの主催者と知り合いで、
まずは少人数のサイクリングイベントで使用してもらい、アンケートなどでフィードバックを集めたいと考えています

## サービスの差別化ポイント・推しポイント
参加者向けの位置共有アプリやルート案内アプリは存在しますが、
**管理側視点でイベント全体を把握できる機能と、ナビ機能を組み合わせている点**
が既存サービスとの大きな違いです

## 機能候補
### MVPリリース時
- ユーザー登録・ログイン
- MAP表示
- エイドステーションのピン表示
- 他の参加者の位置表示・定期更新

### 本リリース時
- コースルートの描画（GPX/KMLインポート）
- 管理者機能（最低限）
- イベント作成・編集
- コース・エイド情報の登録
- WebSocket(ActionCable/Socket.IO)でリアルタイム更新

### 位置情報プライバシー対策
- 位置共有のON/OFFを参加者側で設定可能
- イベント終了後、自動的に位置履歴を削除

## 使用する技術スタック

### フロントエンド
- Leaflet.js（地図描画）
- JavaScript / Stimulus（Rails標準）

### バックエンド
- Ruby on Rails 7.x

### データベース
- PostgreSQL

### 認証
- Devise

### デプロイ先
- Heroku（予定）

### 画面遷移図
Figma:https://www.figma.com/board/FSKuJtGme38Go3OMNnMkAx/cycling%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3--%E3%82%B3%E3%83%94%E3%83%BC-?node-id=0-1&p=f&t=lDumQEZMRVQELuAH-0

### 本サービスの概要（700文字以内）
サイクリングイベント参加者の位置とコースを地図上で可視化することで、安全で一体感のあるイベント運営を支援するサービスです。参加者がスマホからイベントに登録すると、現在地がMAP上に表示され、コースルートやエイドステーションの位置・補給情報を確認しながら走行できます。管理者はイベント情報やコース、エイドステーションを登録・編集でき、参加者の位置を一覧で把握することで、コースミスやトラブル発生時に素早く対応できます。また、参加者ごとに位置共有のON/OFFを切り替えられるようにし、プライバシーにも配慮します。想定ユーザーは、サイクリングイベントの主催者・スタッフ・参加者です。本サービスを通じて、「迷わず安心して走れること」「イベント全体の動きが見えること」による安心感と、一体感のあるイベント体験を提供することを目的としています。
。 

### READMEに記載した機能
- [x] ユーザー登録
- [x] ログイン
- [x] イベント一覧表示
- [x] イベント詳細表示（コース・エイド情報を含む）
- [x] MAP表示（Leaflet.js）
- [x] 参加者の現在地表示
- [x] 他参加者の位置表示・定期更新
- [x] 位置共有ON/OFF設定
- [x] 管理者によるイベント作成・編集
- [x] 管理者によるコース・エイド情報登録・編集

### 未ログインでも閲覧または利用できるページ
- [x] トップページ（サービス説明）
- [x] 公開イベント一覧ページ
- [x] 公開イベントのコースMAP・エイド情報

### メールアドレス・パスワード変更確認項目
- [x] パスワード再設定メール → メール内リンク → パスワード再設定画面
- [x] メールアドレス変更確認メール → メール内リンク → メールアドレス変更確定画面

### ER図
[![Image from Gyazo](https://i.gyazo.com/2e743b675b2dd73e36e6dbeff8aa7504.png)](https://gyazo.com/2e743b675b2dd73e36e6dbeff8aa7504)

### 本サービスの概要（700文字以内）
サイクリングイベント参加者の位置とコースを地図上で可視化することで、安全で一体感のあるイベント運営を支援するサービスです。参加者がスマホからイベントに登録すると、現在地がMAP上に表示され、コースルートやエイドステーションの位置・補給情報を確認しながら走行できます。管理者はイベント情報やコース、エイドステーションを登録・編集でき、参加者の位置を一覧で把握することで、コースミスやトラブル発生時に素早く対応できます。また、参加者ごとに位置共有のON/OFFを切り替えられるようにし、プライバシーにも配慮します。想定ユーザーは、サイクリングイベントの主催者・スタッフ・参加者です。本サービスを通じて、「迷わず安心して走れること」「イベント全体の動きが見えること」による安心感と、一体感のあるイベント体験を提供することを目的としています。

### MVPで実装する予定の機能
- ユーザー登録・ログイン機能（Devise）
- イベント一覧表示 / 詳細表示
- イベントへの参加登録（ユーザーとイベントの紐づけ）
- MAP表示（Leaflet.js）
- コース GPX ファイルのアップロードと表示
- エイドステーションの登録 / 編集 / MAP上へのピン表示
- 参加者の現在地表示（イベント参加ごとに1地点のみ保持）
- 他参加者の位置表示・定期更新
- 位置共有ON/OFF設定（参加者側で切り替え）
- 管理者によるイベント作成 / 編集
- 管理者によるコース・エイド情報の登録 / 編集

### テーブル詳細

#### users テーブル（ユーザー情報）
- id : bigint
  ユーザーのPK
- name : string
  表示名（ニックネーム）
- email : string
  ログイン認証用のメールアドレス（ユニーク制約予定）
- encrypted_password : string
  Devise によるパスワードハッシュ
- role : integer
  管理者 / 一般参加者を区別するための権限（enum を想定）

#### eventparticipations テーブル（イベント参加情報＋現在地）
- id : bigint
  PK
- user_id : bigint
  users テーブルへの外部キー（どのユーザーか）
- event_id : bigint
  events テーブルへの外部キー（どのイベントか）
- role_in_event : integer
  イベント内での役割（参加者 / スタッフ / サポートカーなどを enum で表現予定）
- latitude : decimal
  参加者の現在地の緯度
- longitude : decimal
  参加者の現在地の経度
- share_location : boolean
  位置情報の共有ON/OFF設定
- location_update_at : datetime
  位置情報を最後に更新した時刻

#### events テーブル（イベント情報）
- id : bigint
  PK
- user_id : bigint
  イベント作成者（管理者ユーザー）への外部キー
- name : string
  イベント名
- description : text
  イベントの説明文
- starts_at : datetime
  開始日時
- ends_at : datetime
  終了予定日時

#### courses テーブル（コース情報）
- id : bigint
  PK
- user_id : bigint
  コースを登録したユーザー（管理者）への外部キー
- event_id : bigint
  紐づくイベントの外部キー
- name : string
  コース名（ロングコース / ショートコース など）
- distance_km : decimal
  コース距離（km）
- note : text
  コースに関する補足情報  
  （GPXファイル自体はActiveStorageで添付予定）

#### aid_stations テーブル（エイドステーション）
- id : bigint
  PK
- event_id : bigint
  紐づくイベントの外部キー
- name : string
  エイド名（〇〇エイドステーション など）
- latitude : decimal
  エイドの緯度
- longitude : decimal
  エイドの経度
- supplies : text
  提供される補給物（ドリンク、補給食、メカニックサービスなど）

### ER図の注意点
- [x] プルリクエストに最新のER図のスクリーンショットを画像が表示される形で掲載できているか？
- [x] テーブル名は複数形になっているか？
- [x] カラムの型は記載されているか？
- [x] 外部キーは適切に設けられているか？
- [x] リレーションは適切に描かれているか？多対多の関係は存在しないか？
- [x] STIは使用しないER図になっているか？
- [x] Postsテーブルにpost_nameのように"テーブル名+カラム名"を付けていないか？